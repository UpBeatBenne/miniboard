#!/usr/bin/env node
/**
 * Name: mod.d/core/src/node.o
 * Created: 8 June 2021 @ 17:30 BST (16:30 GMT)
 * Author: Daniel Hyders <git@bean.codes>
 * Licence: GNU GPLv3
*/

import express from "express";
import path from "path";
import { logEvent } from "./lib/logger.o";
import { checkForFirstStart } from "./lib/configuration.o";
import Lighthouse from "./lib/exposedClass.o";
import normalRouter from "./routers/normal.route";
import firstRunRouter from "./routers/firstRun.route";
const app = express();
const LighthouseConfig = new Lighthouse("config");

(async function () {
    app.set("view engine", "ejs");
    const firstRun = await checkForFirstStart();

    if (firstRun == false) {
        app.set("views", path.join(__dirname + `/../../../templates/${await LighthouseConfig.get("current")}`));
        app.use("/", normalRouter);
    } if (firstRun == true) {
        app.set("views", path.join(__dirname + `/../../../templates/firstRun`));
        app.use("/", firstRunRouter);
    };

    const listener = app.listen(8550, async function () {
        logEvent(`Lightbox Core Runtime listening on port ${listener.address().port}`, "init");
    });
})();